@model MigrantCreateViewModel

<h2>Добавить мигранта</h2>

<form asp-action="Create" method="post">
    <div class="form-group">
        <label asp-for="Migrant.FullName">Имя</label>
        <input asp-for="Migrant.FullName" class="form-control" />
        <span asp-validation-for="Migrant.FullName" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Migrant.PassportNumber">Паспорт</label>
        <input asp-for="Migrant.PassportNumber" class="form-control" />
        <span asp-validation-for="Migrant.PassportNumber" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Migrant.CountryID">Страна</label>
        <select asp-for="Migrant.CountryID" class="form-control" asp-items="@(new SelectList(Model.Countries, "CountryID", "CountryName"))">
            <option value="">-- выберите страну --</option>
        </select>
        <span asp-validation-for="Migrant.CountryID" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Migrant.BirthDate">Дата рождения</label>
        <input asp-for="Migrant.BirthDate" type="date" class="form-control" />
        <span asp-validation-for="Migrant.BirthDate" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Migrant.Address">Адрес</label>
        <input asp-for="Migrant.Address" class="form-control" />
        <span asp-validation-for="Migrant.Address" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>Добавить язык</label>
        <div class="d-flex gap-2 mb-2">
            <select id="language-select" class="form-control">
                @foreach (var lang in Model.Languages)
                {
                <option value="@lang.LanguageID">@lang.LanguageName</option>
                }
            </select>

            <select id="proficiency-select" class="form-control">
                <option value="Beginner">Beginner</option>
                <option value="Intermediate">Intermediate</option>
                <option value="Advanced">Advanced</option>
                <option value="Fluent">Fluent</option>
            </select>

            <button type="button" id="add-language-btn" class="btn btn-success">+</button>
        </div>
    </div>

    <div class="form-group">
        <label>Выбранные языки</label>
        <div id="selected-languages-list" class="mb-3"></div>
    </div>

    <div id="language-fields"></div>

    <button type="submit" class="btn btn-success">Сохранить</button>
</form>

@section Scripts {
<script>
    let languageIndex = 0;

    document.getElementById('add-language-btn').addEventListener('click', () => {
        const langSelect = document.getElementById('language-select');
        const profSelect = document.getElementById('proficiency-select');

        const langId = langSelect.value;
        const langName = langSelect.options[langSelect.selectedIndex].text;
        const profLevel = profSelect.value;

        const entryId = `lang_${langId}`;
        if (document.getElementById(entryId)) {
            alert("Этот язык уже добавлен.");
            return;
        }

        const container = document.createElement('div');
        container.id = entryId;
        container.className = "d-flex gap-2 align-items-center mb-2";

        container.innerHTML = `
            <input type="hidden" name="SelectedLanguageProficiencies[${languageIndex}].LanguageID" value="${langId}" />
            <input type="hidden" name="SelectedLanguageProficiencies[${languageIndex}].ProficiencyLevel" value="${profLevel}" />
            <input type="hidden" name="SelectedLanguageProficiencies[${languageIndex}].LanguageName" value="${langName}" />
            <span class="form-control-plaintext"><strong>${langName}</strong> — ${profLevel}</span>
            <button type="button" class="btn btn-sm btn-danger remove-language">Удалить</button>
        `;

        document.getElementById('language-fields').appendChild(container);
        languageIndex++;
    });

    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('remove-language')) {
            const container = e.target.closest('div');
            container.remove();
        }
    });
</script>
}
