-- Полное заполнение базы данных FlightSchool
-- Все таблицы заполняются правдоподобными и согласованными данными
SET NOCOUNT ON;

-- Очистка данных (если нужно перезаполнить)
DELETE FROM LessonStatusChanges;
DELETE FROM Lessons;
DELETE FROM Exams;
DELETE FROM StudentCertificates;
DELETE FROM Certificates;
DELETE FROM Students;
DELETE FROM Instructors;
DELETE FROM Aircraft;
DELETE FROM Courses;
GO

-- Сброс счетчиков идентификаторов
DBCC CHECKIDENT ('Courses', RESEED, 0);
DBCC CHECKIDENT ('Instructors', RESEED, 0);
DBCC CHECKIDENT ('Aircraft', RESEED, 0);
DBCC CHECKIDENT ('Students', RESEED, 0);
DBCC CHECKIDENT ('Lessons', RESEED, 0);
DBCC CHECKIDENT ('LessonStatusChanges', RESEED, 0);
DBCC CHECKIDENT ('Exams', RESEED, 0);
DBCC CHECKIDENT ('Certificates', RESEED, 0);
DBCC CHECKIDENT ('StudentCertificates', RESEED, 0);
GO

-- ============================================
-- СПРАВОЧНИКИ (минимум 3 записи)
-- ============================================

-- Инструкторы (справочник)
INSERT INTO Instructors (FullName, Email, Phone, Rank, HireDate, IsActive)
VALUES
(N'Иванов Пётр Сергеевич', N'ivanov@school.ru', N'+7 900 111-11-11', N'Старший инструктор', '2020-01-15', 1),
(N'Сидорова Анна Викторовна', N'sidorova@school.ru', N'+7 900 222-22-22', N'Инструктор', '2021-03-20', 1),
(N'Павлов Дмитрий Олегович', N'pavlov@school.ru', N'+7 900 333-33-33', N'Инструктор', '2022-05-10', 1),
(N'Козлова Елена Владимировна', N'kozlova@school.ru', N'+7 900 444-44-44', N'Инструктор', '2021-08-12', 1),
(N'Морозов Игорь Александрович', N'morozov@school.ru', N'+7 900 555-55-55', N'Старший инструктор', '2019-11-05', 1);
GO

-- Курсы (справочник)
INSERT INTO Courses (Name, Category, Description, RequiredHours, IsActive)
VALUES
(N'PPL(A)', N'Начальная подготовка', N'Частный пилот самолета - базовый курс для получения лицензии частного пилота', 45, 1),
(N'NVFR', N'Расширение', N'Полеты по приборам ночью - расширение лицензии для ночных полетов', 10, 1),
(N'IR(A)', N'Инструментальный рейтинг', N'Полеты по приборам - обучение полетам в условиях ограниченной видимости', 40, 1),
(N'CPL(A)', N'Коммерческая подготовка', N'Коммерческий пилот самолета - профессиональная лицензия', 200, 1),
(N'ATPL(A)', N'Транспортная подготовка', N'Транспортный пилот самолета - высший уровень подготовки', 1500, 1);
GO

-- Самолеты (справочник)
INSERT INTO Aircraft (TailNumber, Model, Type, Year, TotalHours, Status)
VALUES
(N'RA-12345', N'Cessna 172', N'SEP', 2005, 5200, N'Доступен'),
(N'RA-54321', N'Diamond DA40', N'SEP', 2010, 3100, N'Доступен'),
(N'RA-77777', N'Piper PA-28', N'SEP', 2002, 6800, N'На обслуживании'),
(N'RA-88888', N'Cessna 152', N'SEP', 1998, 8900, N'Доступен'),
(N'RA-99999', N'Diamond DA42', N'MEP', 2015, 2100, N'Доступен');
GO

-- ============================================
-- РАБОЧИЕ ТАБЛИЦЫ (минимум 7 записей)
-- ============================================

-- Курсанты (рабочая таблица)
INSERT INTO Students (FullName, Email, Phone, Address, BirthDate, MedicalCertificateNo, EnrollmentDate, CourseID, Notes)
VALUES
(N'Петров Алексей Николаевич', N'petrov@students.ru', N'+7 901 111-11-11', N'г. Москва, ул. Ленина, д. 10, кв. 5', '2000-01-15', N'MED-001', '2024-01-10', 1, N'Опытный курсант, хорошие результаты'),
(N'Кузнецова Мария Игоревна', N'kuznecova@students.ru', N'+7 901 222-22-22', N'г. Санкт-Петербург, пр. Невский, д. 25', '1999-05-20', N'MED-002', '2024-02-01', 1, N'Внимательная, ответственная'),
(N'Смирнов Иван Андреевич', N'smirnov@students.ru', N'+7 901 333-33-33', N'г. Казань, ул. Баумана, д. 15', '2001-03-25', N'MED-003', '2024-01-20', 2, N'Быстро осваивает материал'),
(N'Егорова Ольга Сергеевна', N'egorova@students.ru', N'+7 901 444-44-44', N'г. Новосибирск, ул. Красный проспект, д. 30', '1998-11-10', N'MED-004', '2023-12-15', 3, N'Стремится к профессиональной карьере'),
(N'Васильев Сергей Петрович', N'vasiliev@students.ru', N'+7 901 555-55-55', N'г. Екатеринбург, ул. Мира, д. 8', '2002-07-07', N'MED-005', '2024-03-01', 1, N'Новичок, требует дополнительного внимания'),
(N'Морозова Татьяна Никитична', N'morozova@students.ru', N'+7 901 666-66-66', N'г. Нижний Новгород, ул. Покровка, д. 12', '1997-02-12', N'MED-006', '2023-11-20', 3, N'Опытный курсант, готовится к экзамену'),
(N'Григорьев Павел Романович', N'grigoriev@students.ru', N'+7 901 777-77-77', N'г. Самара, ул. Московское шоссе, д. 45', '1996-09-18', N'MED-007', '2023-10-10', 2, N'Отличные результаты, рекомендован к продолжению обучения'),
(N'Федорова Анна Дмитриевна', N'fedorova@students.ru', N'+7 901 888-88-88', N'г. Ростов-на-Дону, ул. Большая Садовая, д. 20', '2000-08-30', N'MED-008', '2024-02-15', 1, N''),
(N'Лебедев Максим Викторович', N'lebedev@students.ru', N'+7 901 999-99-99', N'г. Краснодар, ул. Красная, д. 5', '1999-12-05', N'MED-009', '2024-01-05', 3, N'Активный курсант'),
(N'Соколова Елена Анатольевна', N'sokolova@students.ru', N'+7 901 000-00-00', N'г. Воронеж, пр. Революции, д. 18', '2001-04-22', N'MED-010', '2024-03-10', 2, N'');
GO

-- Занятия (рабочая таблица)
INSERT INTO Lessons (StudentID, InstructorID, CourseID, AircraftID, Date, DurationHours, Topic, Status, Remarks)
VALUES
-- Занятия для Петрова (StudentID=1, CourseID=1)
(1, 1, 1, 1, '2024-01-15', 1.5, N'Первое ознакомительное занятие', N'Завершено', N'Курсант показал хорошие способности'),
(1, 1, 1, 1, '2024-01-20', 2.0, N'Взлет и посадка', N'Завершено', N'Отличное выполнение'),
(1, 1, 1, 2, '2024-01-25', 1.5, N'Навигация', N'Завершено', N''),
(1, 1, 1, 1, '2024-02-01', 2.0, N'Полет по кругу', N'Завершено', N'Требуется дополнительная практика'),
(1, 1, 1, 1, '2024-02-10', 1.5, N'Посадка с боковым ветром', N'Одобрено', N'Хорошо освоено'),

-- Занятия для Кузнецовой (StudentID=2, CourseID=1)
(2, 2, 1, 2, '2024-02-05', 1.5, N'Первое занятие', N'Завершено', N'Внимательная и аккуратная'),
(2, 2, 1, 2, '2024-02-12', 2.0, N'Взлет и посадка', N'Завершено', N''),
(2, 2, 1, 1, '2024-02-18', 1.5, N'Навигация', N'В процессе', N'В процессе'),

-- Занятия для Смирнова (StudentID=3, CourseID=2)
(3, 3, 2, 1, '2024-01-25', 2.0, N'Ночные полеты - основы', N'Завершено', N'Отличные результаты'),
(3, 3, 2, 1, '2024-02-05', 1.5, N'Ночная навигация', N'Завершено', N''),
(3, 3, 2, 2, '2024-02-15', 2.0, N'Ночные посадки', N'Одобрено', N'Готов к экзамену'),

-- Занятия для Егоровой (StudentID=4, CourseID=3)
(4, 1, 3, 1, '2024-01-10', 2.0, N'Инструментальные полеты - введение', N'Завершено', N'Серьезный подход'),
(4, 1, 3, 1, '2024-01-20', 2.5, N'Работа с приборами', N'Завершено', N''),
(4, 1, 3, 2, '2024-02-01', 2.0, N'Заход на посадку по приборам', N'Завершено', N'Хорошо освоено'),
(4, 1, 3, 1, '2024-02-12', 2.0, N'Сложные метеоусловия', N'В процессе', N'Требуется практика'),

-- Занятия для Васильева (StudentID=5, CourseID=1)
(5, 2, 1, 2, '2024-03-05', 1.5, N'Первое занятие', N'Запланировано', N'Запланировано'),
(5, 2, 1, 1, '2024-03-12', 1.5, N'Основы управления', N'Запланировано', N''),

-- Занятия для Морозовой (StudentID=6, CourseID=3)
(6, 3, 3, 1, '2024-01-15', 2.0, N'Повторение материала', N'Завершено', N'Подготовка к экзамену'),
(6, 3, 3, 2, '2024-01-25', 2.5, N'Экзаменационная подготовка', N'Завершено', N''),
(6, 3, 3, 1, '2024-02-05', 2.0, N'Финальная проверка', N'Одобрено', N'Готова к экзамену'),

-- Занятия для Григорьева (StudentID=7, CourseID=2)
(7, 1, 2, 1, '2024-01-20', 1.5, N'Ночные полеты', N'Завершено', N''),
(7, 1, 2, 2, '2024-02-01', 2.0, N'Ночная навигация', N'Завершено', N'Отлично'),
(7, 1, 2, 1, '2024-02-15', 1.5, N'Практика ночных посадок', N'Одобрено', N'');
GO

-- Изменения статусов занятий (автоматически создаются при изменении статуса)
-- Здесь добавляем некоторые записи вручную для полноты данных
INSERT INTO LessonStatusChanges (LessonID, ChangedAt, OldStatus, NewStatus, Comment)
SELECT TOP 5 LessonID, Date, '', Status, N'Создано занятие'
FROM Lessons
WHERE Status IN ('Завершено', 'Одобрено')
ORDER BY LessonID;
GO

-- Экзамены (рабочая таблица)
-- Примечание: InstructorID соответствует инструкторам:
-- 1 = Иванов Пётр Сергеевич, 2 = Сидорова Анна Викторовна, 3 = Павлов Дмитрий Олегович,
-- 4 = Козлова Елена Владимировна, 5 = Морозов Игорь Александрович
INSERT INTO Exams (StudentID, CourseID, Date, Score, Result, InstructorID)
VALUES
(1, 1, '2024-02-15', 95.5, N'Сдан', 1),
(2, 1, '2024-02-20', 88.0, N'Сдан', 2),
(3, 2, '2024-02-25', 92.0, N'Сдан', 3),
(4, 3, '2024-02-10', 90.0, N'Сдан', 1),
(6, 3, '2024-02-28', 85.5, N'Сдан', 5),
(7, 2, '2024-02-22', 89.0, N'Сдан', 4),
(1, 1, '2024-03-01', 78.0, N'Не сдан', 1),
(3, 2, '2024-03-05', 91.5, N'Сдан', 3),
(4, 3, '2024-03-10', 87.0, N'Сдан', 1),
(6, 3, '2024-03-15', 93.0, N'Сдан', 5);
GO

-- Шаблоны сертификатов
INSERT INTO Certificates (Title, Description, CourseID, DefaultValidityDays)
VALUES
(N'PPL(A) License', N'Свидетельство частного пилота для выпускников курса PPL(A)', 1, 1825),
(N'NVFR Endorsement', N'Допуск к ночным полетам после курса NVFR', 2, 1825),
(N'Instrument Rating', N'Рейтинг полетов по приборам для курса IR(A)', 3, 1825);

-- Выданные сертификаты
INSERT INTO StudentCertificates (StudentID, CertificateID, IssuedDate, CertificateNumber, ValidUntil, Status)
VALUES
(1, 1, '2024-02-20', N'PPL-2024-001', '2029-02-20', N'Активен'),
(2, 1, '2024-02-25', N'PPL-2024-002', '2029-02-25', N'Активен'),
(5, 1, '2024-03-12', N'PPL-2024-003', '2029-03-12', N'Активен'),
(3, 2, '2024-03-01', N'NVFR-2024-001', '2029-03-01', N'Активен'),
(7, 2, '2024-03-10', N'NVFR-2024-002', '2029-03-10', N'Активен'),
(4, 3, '2024-03-05', N'IR-2024-001', '2029-03-05', N'Активен'),
(6, 3, '2024-03-20', N'IR-2024-002', '2029-03-20', N'Активен');
GO

SET NOCOUNT OFF;
PRINT N'База данных успешно заполнена тестовыми данными!';
PRINT N'Инструкторы: 5 записей';
PRINT N'Курсы: 5 записей';
PRINT N'Самолеты: 5 записей';
PRINT N'Курсанты: 10 записей';
PRINT N'Занятия: 20 записей';
PRINT N'Экзамены: 10 записей';
PRINT N'Шаблоны сертификатов: 3 записи';
PRINT N'Выданные сертификаты: 7 записей';


