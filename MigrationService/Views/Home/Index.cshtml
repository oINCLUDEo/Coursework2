@{
    ViewData["Title"] = "Главная";
}

<div class="container mt-4">
    <div class="card shadow-sm mb-4">
        <div class="card-body text-center py-5">
            <h1 class="display-4 mb-3">Летная школа</h1>
            <p class="lead mb-4">Добро пожаловать в систему управления учебными полетами</p>
            <hr class="my-4">
            <p class="mb-0">Управляйте курсантами, занятиями, инструкторами, самолетами и курсами в одном месте.</p>
        </div>
    </div>

    <div class="row mt-4 g-3 justify-content-center">
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card kpi kpi-students h-100">
                <div class="card-body">
                    <div class="kpi-icon"><i class="fas fa-user-graduate"></i></div>
                    <div class="kpi-title">Курсанты</div>
                    <div class="kpi-value">@ViewBag.StudentsCount</div>
                    <a href="@Url.Action("Index", "Students")" class="btn btn-outline-light btn-sm kpi-action">Управление</a>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card kpi kpi-instructors h-100">
                <div class="card-body">
                    <div class="kpi-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                    <div class="kpi-title">Инструкторы</div>
                    <div class="kpi-value">@ViewBag.InstructorsCount</div>
                    <a href="@Url.Action("Index", "Instructors")" class="btn btn-outline-light btn-sm kpi-action">Управление</a>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card kpi kpi-aircraft h-100">
                <div class="card-body">
                    <div class="kpi-icon"><i class="fas fa-plane"></i></div>
                    <div class="kpi-title">Самолеты</div>
                    <div class="kpi-value">@ViewBag.AircraftCount</div>
                    <a href="@Url.Action("Index", "Aircraft")" class="btn btn-outline-light btn-sm kpi-action">Управление</a>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card kpi kpi-courses h-100">
                <div class="card-body">
                    <div class="kpi-icon"><i class="fas fa-book"></i></div>
                    <div class="kpi-title">Курсы</div>
                    <div class="kpi-value">@ViewBag.CoursesCount</div>
                    <a href="@Url.Action("Index", "Courses")" class="btn btn-outline-light btn-sm kpi-action">Управление</a>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card kpi kpi-lessons h-100">
                <div class="card-body">
                    <div class="kpi-icon"><i class="fas fa-clock"></i></div>
                    <div class="kpi-title">Занятия</div>
                    <div class="kpi-value">@ViewBag.LessonsCount</div>
                    <a href="@Url.Action("Index", "Lessons")" class="btn btn-outline-light btn-sm kpi-action">Перейти</a>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card kpi kpi-exams h-100">
                <div class="card-body">
                    <div class="kpi-icon"><i class="fas fa-check-double"></i></div>
                    <div class="kpi-title">Экзамены</div>
                    <div class="kpi-value">@ViewBag.ExamsCount</div>
                    <a href="@Url.Action("Index", "Exams")" class="btn btn-outline-light btn-sm kpi-action">Управление</a>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card kpi kpi-certificates h-100">
                <div class="card-body">
                    <div class="kpi-icon"><i class="fas fa-certificate"></i></div>
                    <div class="kpi-title">Сертификаты</div>
                    <div class="kpi-value">@ViewBag.CertificatesCount</div>
                    <a href="@Url.Action("Index", "Certificates")" class="btn btn-outline-light btn-sm kpi-action">Управление</a>
                </div>
            </div>
        </div>
    </div>

    @if (ViewBag.UpcomingLessons != null && ((List<MigrationService.Controllers.HomeController.UpcomingLessonResult>)ViewBag.UpcomingLessons).Any())
    {
        <div class="card shadow-sm mt-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-calendar-alt"></i> Предстоящие занятия (ближайшие 7 дней)</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Курсант</th>
                                <th>Инструктор</th>
                                <th>Самолет</th>
                                <th>Тема</th>
                                <th>Длительность</th>
                                <th>Статус</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var lesson in (List<MigrationService.Controllers.HomeController.UpcomingLessonResult>)ViewBag.UpcomingLessons)
                            {
                                <tr>
                                    <td>@lesson.Date.ToString("yyyy-MM-dd")</td>
                                    <td>@lesson.StudentName</td>
                                    <td>@lesson.InstructorName</td>
                                    <td>@lesson.TailNumber</td>
                                    <td>@lesson.Topic</td>
                                    <td>@lesson.DurationHours ч</td>
                                    <td>
                                        <span class="badge bg-@(lesson.Status == "Planned" ? "info" : lesson.Status == "InProgress" ? "warning" : "success")">
                                            @lesson.Status
                                        </span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <small class="text-muted">Данные получены через хранимую процедуру sp_GetUpcomingLessons</small>
            </div>
        </div>
    }
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
} 